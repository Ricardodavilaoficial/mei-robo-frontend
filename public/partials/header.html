<!-- public/partials/header.html (updated: hide legacy fallbacks safely) -->
<header class="site-header" style="position:sticky;top:0;z-index:1000;background:#0b1f17;color:#fff;border-bottom:1px solid rgba(255,255,255,.08);">
  <div class="container" style="max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:16px;min-height:58px;">
    <!-- Marca -->
    <a href="/index.html" style="display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit;">
      <img src="/assets/mei-robo-icon.png" alt="MEI Robô" width="26" height="26" style="display:block;border-radius:6px;object-fit:cover;">
      <strong style="font-size:18px;letter-spacing:.2px;text-transform:uppercase;">MEI ROBÔ</strong>
    </a>

    <div style="flex:1"></div>

    <!-- Navegação básica (âncoras seguras) -->
    <nav aria-label="Menu principal" style="display:flex;gap:6px;align-items:center;">
      <a href="/index.html" data-nav="home" style="color:#cfe8dd;text-decoration:none;font-size:14px;line-height:42px;padding:0 10px;border-radius:8px;display:inline-block;">Início</a>
      <a href="/#como-funciona" data-nav="como" style="color:#cfe8dd;text-decoration:none;font-size:14px;line-height:42px;padding:0 10px;border-radius:8px;display:inline-block;">Como funciona</a>
      <a href="/#precos" data-nav="precos" style="color:#cfe8dd;text-decoration:none;font-size:14px;line-height:42px;padding:0 10px;border-radius:8px;display:inline-block;">Preços</a>
    </nav>

    <!-- Ações -->
    <div class="actions" style="display:flex;gap:10px;align-items:center;margin-left:8px;">
      <a href="/login.html" id="link-entrar" style="color:#cfe8dd;text-decoration:none;font-size:14px;line-height:40px;padding:0 8px;border-radius:8px;display:inline-block;">Entrar</a>
      <span id="saudacao" style="display:none;color:#cfe8dd;font-size:14px;opacity:.9;"></span>
      <button id="btn-sair" type="button" style="display:none;background:transparent;color:#cfe8dd;border:1px solid rgba(255,255,255,.18);border-radius:10px;font-size:14px;padding:8px 12px;cursor:pointer;">Sair</button>
      <a href="/cadastro.html" style="background:#22c55e;color:#0b1f17;text-decoration:none;font-weight:600;font-size:14px;padding:8px 12px;border-radius:10px;display:inline-block;">
        Quero usar o MEI Robô
      </a>
    </div>
  </div>

  <!-- Acessibilidade + Blindagem de fallback -->
  <style>
    .site-header a:focus-visible, .site-header button:focus-visible { outline: 2px solid #22c55e; outline-offset: 2px; }
    .site-header a[aria-current="page"] { background: rgba(255,255,255,.09); }
    /* Blindagem: se existir um header de fallback com estas classes/atributos em qualquer página,
       ele é ocultado quando este parcial está presente. */
    header._fallback, header.header-fallback, header[data-fallback], #header-fallback {{ display: none !important; }}
  </style>

  <!-- Script defensivo: autenticação e aria-current (opcional) -->
  <script>
    (function() {{
      try {{
        // Marcação da aba atual
        var navHome = document.querySelector('a[data-nav="home"]');
        var navComo = document.querySelector('a[data-nav="como"]');
        var navPrecos = document.querySelector('a[data-nav="precos"]');
        if (navHome && (/\/index\.html$/.test(location.pathname) || location.pathname === "/")) navHome.setAttribute("aria-current", "page");
        if (navComo && /#como-funciona$/.test(location.hash)) navComo.setAttribute("aria-current", "page");
        if (navPrecos && /#precos$/.test(location.hash)) navPrecos.setAttribute("aria-current", "page");

        // Toggle Entrar/Sair/saudação (se Firebase Auth existir). Sem login, nada muda.
        var hasFirebase = !!(window.firebase && window.firebase.auth);
        var linkEntrar = document.getElementById("link-entrar");
        var btnSair = document.getElementById("btn-sair");
        var saud = document.getElementById("saudacao");

        function firstNameFromEmail(email) {{
          if (!email) return "";
          var name = (email.split("@")[0] || "");
          return name.charAt(0).toUpperCase() + name.slice(1);
        }}

        function applyUserUI(user) {{
          if (!linkEntrar || !btnSair || !saud) return;
          if (user) {{
            var nome = (user.displayName && user.displayName.trim()) || firstNameFromEmail(user.email) || "você";
            saud.textContent = "Olá, " + nome;
            saud.style.display = "inline";
            btnSair.style.display = "inline-block";
            linkEntrar.style.display = "none";
          }} else {{
            saud.style.display = "none";
            btnSair.style.display = "none";
            linkEntrar.style.display = "inline-block";
          }}
        }}

        if (hasFirebase) {{
          window.firebase.auth().onAuthStateChanged(function(user) {{ applyUserUI(user); }});
          btnSair && btnSair.addEventListener("click", function() {{
            try {{ btnSair.disabled = true; window.firebase.auth().signOut().finally(function(){{ btnSair.disabled = false; }}); }}
            catch (e) {{ btnSair.disabled = false; }}
          }});
        }} else {{
          applyUserUI(null);
        }}
      }} catch (err) {{ try {{ console.warn("[header] Non-fatal:", err.message || err); }} catch(_ ){{}} }}
    }})();
  </script>
</header>
